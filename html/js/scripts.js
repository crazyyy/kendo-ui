function MapSetSize(){"number"==typeof window.innerWidth?(myWidth=window.innerWidth,myHeight=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(myWidth=document.documentElement.clientWidth,myHeight=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(myWidth=document.body.clientWidth,myHeight=document.body.clientHeight),document.getElementById("map").style.width=myWidth-20+"px",document.getElementById("map").style.height=myHeight-20+"px"}function concatResult(){var e=document.getElementById("sumResult");e.checked?(window.dataStFull=[],console.log("clear data array ")):console.log("not cheked, do not clear array with result")}function ParseJson(e){for(var t=0;t<e.response.venues.length;t++){var o=e.response.venues[t];dataStFull.push({name:o.name,latlng:[o.location.lat,o.location.lng],distance:o.location.distance,address:o.location.formattedAddress,city:o.location.city,id:o.id,catName:o.categories[0].name,catImage:o.categories[0].icon.prefix+"32"+o.categories[0].icon.suffix,shape:"pinTarget"})}return dataStFull}function ParseImage(){var e="https://api.foursquare.com/v2/venues/"+id+"/photos?oauth_token="+fsqToken+"&v=20150724";console.log("start test"),$.getJSON(e,function(e,t){if("success"!==t)return alert("Request Img from Foursquare failed");for(var o=0;o<e.response.photos.items.length;o++)photoA=e.response.photos.items[o],photosArr.push({idObject:id,idImaget:photoA.id,prefix:photoA.prefix,suffix:photoA.suffix,width:photoA.width,height:photoA.height,cropedImg:photoA.prefix+"300x300"+photoA.suffix,fullImg:photoA.prefix+photoA.width+"x"+photoA.height+photoA.suffix}),console.log(photosArr.length);console.log(photosArr.length)})}function ParseAndBuildMap(e,t){var o="https://api.foursquare.com/v2/venues/search?client_id="+fsqId+"&client_secret="+fsqSecret+"&v=20150717&ll=cordCenter&query=searchQuery&callback=?".replace("searchQuery",searchQuery);$.getJSON(o.replace("cordCenter",e+","+t),function(o,n){if("success"!==n)return alert("Request to Foursquare failed");ParseJson(o);var a=new kendo.data.DataSource({data:dataStFull});MapDrawer(e,t,a)})}function MakeMarkers(e){return makedMarkers={type:"marker",dataSource:e,locationField:"latlng",titleField:"name",shape:"green",city:"city",tooltip:{content:function(e){var t=(e.sender.marker,kendo.template("HTML tags are encoded: #: html #")),o={html:"<strong>#= marker.dataItem.city #</strong>"};return t(o)}}},makedMarkers}function MapDrawer(e,t,o){$("#map").kendoMap({center:[parseFloat(e),parseFloat(t)],zoom:14,controls:{navigator:{position:"topRight"},zoom:{position:"topRight"}},layers:[{type:"tile",urlTemplate:"http://#= subdomain #.tile2.opencyclemap.org/transport/#= zoom #/#= x #/#= y #.png",subdomains:["a","b","c"]},MakeMarkers(o)],markerClick:OnClickMarker})}function SearchAndReplaceData(e){for(var t in window.dataStFull)if(window.dataStFull[t].id===e){window.dataStFull[t].shape="pin",console.log(window.dataStFull[t]);break}}function OnClickMarker(e){var t=e.marker,o=t.dataItem.id;SearchAndReplaceData(o)}function OnClickMap(e){var t=parseFloat(e.location.lat),o=parseFloat(e.location.lng);ParseAndBuildMap(t,o)}function GoogleMapAutocomplite(){var e=document.getElementById("searchTextField"),t=new google.maps.places.Autocomplete(e);google.maps.event.addListener(t,"place_changed",function(){var e=t.getPlace();window.centerLat=e.geometry.location.lat(),window.centerLng=e.geometry.location.lng(),ParseAndBuildMap(centerLat,centerLng)})}function GetCurrentLocation(){function e(e){var t=e.coords,o=t.latitude,n=t.longitude;ParseAndBuildMap(o,n)}function t(e){console.warn("ERROR("+e.code+"): "+e.message)}if(searchInput.value="",searchInput.innerHTML="",ParseAndBuildMap(centerLat,centerLng),Modernizr.geolocation){navigator.geolocation.getCurrentPosition(e,t,o);var o={enableHighAccuracy:!0,timeout:5e3,maximumAge:0}}else console.log("location error")}function CompareObjectsInArray(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}function Nearest(e){e.sort(CompareObjectsInArray);for(var t=document.getElementById("nearestContainer"),o="<tr> < th > Відстань(м.) < /th> < th > Назва закладу < /th> < th > Адреса < /th> < /tr>",n=0;n<e.length;n++)console.log(e[n].name),console.log(),o+="<tr> < td > "+e[n].distance+" < /td> < td > "+e[n].name+" < /td> < td > "+e[n].address+" < /td> < /tr>";t.innerHTML=o}var fsqId="2TVA3RGPADXOJJPZY4VBRWZPJ0GNBLLKLMGEL1VTARBDJ1TV",fsqSecret="FK40OEGZ1ODV1GM1C0SYMB3QYN5LYECMJ0L0JGJWRXAB5WQS",fsqToken="Y5YF5D0YOTAN0LSUOXTWLQJ231HABSAF3ZXJDUEWP45VH1HJ",centerLat="49.233083",centerLng="28.46821699999998",dataStFull=[],photosArr=[],searchQuery="restaurant",searchButton=document.getElementById("goSearch"),goHomeButton=document.getElementById("goHome"),nearest=document.getElementById("nearest"),searchInput=document.getElementById("searchCategories"),uriRecommendation="https://api.foursquare.com/v2/venues/explore?ll="+centerLat+","+centerLng+"&oauth_token="+fsqToken+"&v=20150726";MapSetSize(),window.onresize=function(e){MapSetSize()},searchButton.addEventListener("click",function(){concatResult(),searchQuery=searchInput.value,window.uriWork="https://api.foursquare.com/v2/venues/search?client_id="+fsqId+"&client_secret="+fsqSecret+"&v=20150717&ll=cordCenter&query=searchQuery&callback=?".replace("searchQuery",searchQuery),ParseAndBuildMap(centerLat,centerLng,searchQuery)},!1),goHomeButton.addEventListener("click",function(){GetCurrentLocation()},!1),nearest.addEventListener("click",function(){Nearest(dataStFull)},!1),$("#searchCategories").kendoAutoComplete({dataTextField:"name",dataSource:{type:"json",transport:{read:"content/cat.json"}},minLength:1,filter:"startswith",placeholder:"Категорія об'єкту (напр. ресторан, бар...)"}),google.maps.event.addDomListener(window,"load",GoogleMapAutocomplite),$(document).ready(GetCurrentLocation);