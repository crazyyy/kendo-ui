function MapSetSize(){"number"==typeof window.innerWidth?(windowWidth=window.innerWidth,windowHeight=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(windowWidth=document.documentElement.clientWidth,windowHeight=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(windowWidth=document.body.clientWidth,windowHeight=document.body.clientHeight),document.getElementById("map").style.width=windowWidth-20+"px",document.getElementById("map").style.height=windowHeight-20+"px",$(".aside-nearest").css("max-height",windowHeight+"px")}function concatResult(){var e=document.getElementById("sumResult");e.checked?console.log("clear data array "):(window.dataStFull=[],console.log("not cheked, do not clear array with result"))}function Nearest(e){e.sort(CompareObjectsInArray);for(var t=document.getElementById("nearestContainer"),o="<tr><th> Відстань(м.) </th><th> Назва закладу </th><th> Адреса </th></tr>",n=0;n<e.length;n++)o+="<tr><td> "+e[n].distance+" </td><td> "+e[n].name+" </td><td> "+e[n].address+" </td></tr>";$(".aside-nearest, #aside-nearest-close ").show(),t.innerHTML=o}function CompareObjectsInArray(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}function GetCurrentLocation(){function e(e){var t=e.coords;window.centerLat=t.latitude,window.centerLng=t.longitude}if(Modernizr.geolocation){navigator.geolocation.getCurrentPosition(e,t);var t={enableHighAccuracy:!0,timeout:5e3,maximumAge:0}}else console.log("location error")}function CreateURI(e,t){var o=[];0==$("#map").hasClass("k-map")?(url=uriRecommendation.replace("centerLat",e).replace("centerLng",t).replace("fsqToken",fsqToken),o.push({url:url,id:"recomendation"})):(url=uriWork.replace("fsqId",fsqId).replace("fsqSecret",fsqSecret).replace("centerLat",e).replace("centerLng",t).replace("searchQuery",searchQuery),o.push({url:url,id:"default"})),ParseAndBuildMap(o,e,t)}function ParseAndBuildMap(e,t,o){url=e[0].url,statusId=e[0].id,$.getJSON(url,function(e,n){if("success"!==n)return alert("Request to Foursquare failed");ParseJson(e);var a=new kendo.data.DataSource({data:dataStFull});BuildMap(t,o,a)})}function ParseJson(e){if("default"==statusId)for(var t=0;t<e.response.venues.length;t++){var o=e.response.venues[t];dataStFull.push({name:o.name,latlng:[o.location.lat,o.location.lng],distance:o.location.distance,addressFull:o.location.formattedAddress,address:o.location.address,city:o.location.city,id:o.id,catName:o.categories[0].name,catImage:o.categories[0].icon.prefix+"32"+o.categories[0].icon.suffix,shape:"pinTarget"})}else if("recomendation"==statusId)for(var n=e.response.groups[0].items,t=0;t<n.length;t++){var o=n[t].venue;dataStFull.push({name:o.name,latlng:[o.location.lat,o.location.lng],distance:o.location.distance,addressFull:o.location.formattedAddress,address:o.location.address,city:o.location.city,id:o.id,catName:o.categories[0].name,catImage:o.categories[0].icon.prefix+"32"+o.categories[0].icon.suffix,shape:"pin"})}else console.log("ERROR with URL")}function BuildMap(e,t,o){$("#map").kendoMap({center:[parseFloat(e),parseFloat(t)],zoom:14,controls:{navigator:{position:"topRight"},zoom:{position:"topRight"}},layers:[{type:"tile",urlTemplate:"http://#= subdomain #.tile2.opencyclemap.org/transport/#= zoom #/#= x #/#= y #.png",subdomains:["a","b","c"]},MakeMarkers(o)],click:OnClickMap,markerClick:OnClickMarker})}function MakeMarkers(e){var t=["red","orange","yellow","green","blue","indigo","violet"],o=t[Math.floor(Math.random()*t.length)];return makedMarkers={type:"marker",dataSource:e,locationField:"latlng",titleField:"name",shape:o},makedMarkers}function Map(){GetCurrentLocation(),CreateURI(centerLat,centerLng)}function SearchOnMap(e,t,o){CreateURI(e,t,o)}function GoogleMapAutocomplite(){var e=document.getElementById("searchTextField"),t=new google.maps.places.Autocomplete(e);google.maps.event.addListener(t,"place_changed",function(){var e=t.getPlace();window.centerLat=e.geometry.location.lat(),window.centerLng=e.geometry.location.lng(),CreateURI(centerLat,centerLng)})}function SearchUserObject(){concatResult(),console.log(window.searchQuery),window.searchQuery=searchInput.value,CreateURI(centerLat,centerLng)}function OnClickMap(e){window.centerLat=parseFloat(e.location.lat),window.centerLng=parseFloat(e.location.lng),CreateURI(centerLat,centerLng)}function OnClickMarker(e){var t=e.marker,o=t.dataItem.id;ParseMarkerPhoto(o)}function ParseMarkerPhoto(e){var t=uriPhoto.replace("markerId",e).replace("fsqToken",fsqToken);$.getJSON(t,function(e,t){if("success"!==t)return alert("Request to Foursquare failed");for(var o=[],n=0;n<e.response.photos.items.length;n++)photoA=e.response.photos.items[n],o.push({idImaget:photoA.id,prefix:photoA.prefix,suffix:photoA.suffix,width:photoA.width,height:photoA.height,cropedImg:photoA.prefix+"300x300"+photoA.suffix,fullImg:photoA.prefix+photoA.width+"x"+photoA.height+photoA.suffix});ListObjectPhoto(o),console.log(o)})}function ListObjectPhoto(e){for(var t=document.getElementById("photosContainer"),o="",n=0;n<e.length;n++)o+='<li><a rel="lightbox" href="'+e[n].fullImg+'"><img src="'+e[n].cropedImg+'" alt=""/></a></li>';$(".aside-photo, #aside-photo-close").show(),t.innerHTML=o}var fsqId="2TVA3RGPADXOJJPZY4VBRWZPJ0GNBLLKLMGEL1VTARBDJ1TV",fsqSecret="FK40OEGZ1ODV1GM1C0SYMB3QYN5LYECMJ0L0JGJWRXAB5WQS",fsqToken="Y5YF5D0YOTAN0LSUOXTWLQJ231HABSAF3ZXJDUEWP45VH1HJ",centerLat="49.233083",centerLng="28.46821699999998",dataStFull=[],searchQuery="restaurant",searchButton=document.getElementById("goSearch"),goHomeButton=document.getElementById("goHome"),nearest=document.getElementById("nearest"),searchInput=document.getElementById("searchCategories"),uriWork="https://api.foursquare.com/v2/venues/search?client_id=fsqId&client_secret=fsqSecret&v=20150717&ll=centerLat,centerLng&query=searchQuery&callback=?",uriRecommendation="https://api.foursquare.com/v2/venues/explore?ll=centerLat,centerLng&oauth_token=fsqToken&v=20150726",uriPhoto="https://api.foursquare.com/v2/venues/markerId/photos?oauth_token=fsqToken&v=20150724",uriCategories="content/cat.json";MapSetSize(),window.onresize=function(e){MapSetSize()},searchButton.addEventListener("click",function(){SearchUserObject()},!1),$(searchInput).keyup(function(e){13==e.keyCode&&SearchUserObject()}),goHomeButton.addEventListener("click",function(){GetCurrentLocation(),CreateURI(centerLat,centerLng)},!1),nearest.addEventListener("click",function(){Nearest(dataStFull)},!1),$("#searchCategories").kendoAutoComplete({dataTextField:"name",dataSource:{type:"json",transport:{read:uriCategories}},minLength:1,filter:"startswith",placeholder:"Категорія об'єкту (напр. ресторан, бар...)"}),document.getElementById("aside-control-close").addEventListener("click",function(){$(this).toggleClass("aside-control-close-closed"),$(".aside-control").toggleClass("aside-control-hide")},!1),document.getElementById("aside-nearest-close").addEventListener("click",function(){$(".aside-nearest, #aside-nearest-close").hide()},!1),document.getElementById("aside-photo-close").addEventListener("click",function(){$(".aside-photo, #aside-photo-close").hide()},!1),$(document).ready(Map()),google.maps.event.addDomListener(window,"load",GoogleMapAutocomplite);