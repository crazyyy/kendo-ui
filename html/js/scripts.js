function ParseAndBuildMap(e,t){var a="https://api.foursquare.com/v2/venues/search?client_id="+fsqId+"&client_secret="+fsqSecret+"&v=20150717&ll=cordCenter&query=searchQuery&callback=?".replace("searchQuery",searchQuery);$.getJSON(a.replace("cordCenter",e+","+t),function(a,n){if("success"!==n)return alert("Request to Foursquare failed");for(var o=0;o<a.response.venues.length;o++){var r=a.response.venues[o];dataStFull.push({name:r.name,latlng:[r.location.lat,r.location.lng],distance:r.location.distance,address:r.location.formattedAddress})}var c=new kendo.data.DataSource({data:dataStFull});MapDrawer(e,t,c)})}function MapDrawer(e,t,a){$("#map").kendoMap({center:[parseFloat(e),parseFloat(t)],zoom:14,layers:[{type:"tile",urlTemplate:"http://#= subdomain #.tile2.opencyclemap.org/transport/#= zoom #/#= x #/#= y #.png",subdomains:["a","b","c"],attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap contributors</a>.Tiles courtesy of <a href="http://www.opencyclemap.org/">Andy Allan</a>'},{type:"marker",dataSource:a,locationField:"latlng",titleField:"name"}],click:OnClickMap})}function OnClickMap(e){var t=parseFloat(e.location.lat),a=parseFloat(e.location.lng);ParseAndBuildMap(t,a)}function GoogleMapAutocomplite(){var e=document.getElementById("searchTextField"),t=new google.maps.places.Autocomplete(e);google.maps.event.addListener(t,"place_changed",function(){var e=t.getPlace();window.centerLat=e.geometry.location.lat(),window.centerLng=e.geometry.location.lng(),ParseAndBuildMap(centerLat,centerLng)})}function GetCurrentLocation(){function e(e){var t=e.coords,a=t.latitude,n=t.longitude;ParseAndBuildMap(a,n)}function t(e){console.warn("ERROR("+e.code+"): "+e.message)}if(searchInput.value="",searchInput.innerHTML="",ParseAndBuildMap(centerLat,centerLng),Modernizr.geolocation){navigator.geolocation.getCurrentPosition(e,t,a);var a={enableHighAccuracy:!0,timeout:5e3,maximumAge:0}}else console.log("location error")}function concatResult(){var e=document.getElementById("sumResult");e.checked?(window.dataStFull=[],console.log("clear data array ")):console.log("not cheked, do not clear array with result")}function CompareObjectsInArray(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}function SortDistance(e){e.sort(CompareObjectsInArray),console.log(e.distance),console.log(e[1].distance),console.log(e[2].distance)}function Nearest(e){console.log(e[0].distance)}var fsqId="2TVA3RGPADXOJJPZY4VBRWZPJ0GNBLLKLMGEL1VTARBDJ1TV",fsqSecret="FK40OEGZ1ODV1GM1C0SYMB3QYN5LYECMJ0L0JGJWRXAB5WQS",centerLat="49.233083",centerLng="28.46821699999998",dataStFull=[],searchQuery="restaurant",searchButton=document.getElementById("goSearch"),goHomeButton=document.getElementById("goHome"),searchInput=document.getElementById("searchCategories"),rec=document.getElementById("rec");google.maps.event.addDomListener(window,"load",GoogleMapAutocomplite),$(document).ready(GetCurrentLocation),searchButton.addEventListener("click",function(){concatResult(),searchQuery=searchInput.value,window.workUri="https://api.foursquare.com/v2/venues/search?client_id="+fsqId+"&client_secret="+fsqSecret+"&v=20150717&ll=cordCenter&query=searchQuery&callback=?".replace("searchQuery",searchQuery),ParseAndBuildMap(centerLat,centerLng,searchQuery)},!1),goHomeButton.addEventListener("click",function(){GetCurrentLocation()},!1),rec.addEventListener("click",function(){SortDistance(dataStFull)},!1),$("#searchCategories").kendoAutoComplete({dataTextField:"name",dataSource:{type:"json",transport:{read:"content/cat.json"}},minLength:1,filter:"startswith",placeholder:"Категорія об'єкту"});